RewriteEngine On

# Redirect index.html to root
RewriteCond %{THE_REQUEST} /index\.html
RewriteRule ^index\.html$ / [R=301,L]

# Serve index.html for root
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^$ index.html [L]

# Birthday page routing
RewriteRule ^birthday/([a-zA-Z0-9]+)/?$ home.php?id=$1 [L,QSA]

# Security - Hide PHP files from direct access
<Files "*.php">
    Order Allow,Deny
    Allow from all
</Files>

# Allow specific PHP files
<Files "save_birthday.php">
    Order Allow,Deny
    Allow from all
</Files>

<Files "get_birthday.php">
    Order Allow,Deny
    Allow from all
</Files>

<Files "home.php">
    Order Allow,Deny
    Allow from all
</Files>

# Disable directory browsing
Options -Indexes

# Security headers
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options SAMEORIGIN
    Header always set X-XSS-Protection "1; mode=block"
</IfModule>

# File upload security
<Files ~ "\.(php|pl|py|jsp|asp|sh|cgi)$">
    Order Deny,Allow
    Deny from all
</Files>

# Allow only in uploads directory
<Directory "uploads/">
    <Files ~ "\.(php|pl|py|jsp|asp|sh|cgi)$">
        Order Deny,Allow
        Deny from all
    </Files>
</Directory>

# Cache control for static files
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType audio/mpeg "access plus 1 month"
    ExpiresByType audio/wav "access plus 1 month"
    ExpiresByType audio/ogg "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
</IfModule>
